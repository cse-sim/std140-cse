<%#INTERFACE
  parameter "orientation", :default=>30
  parameter "case_name"
  parameter "cell"
  parameter "insulated_windows"
  parameter "imputed_conductivities"
  parameter "constant_interior_coefficients"
%>

<%
# Unit Conversions
$m_ft = 3.28084
$m2_ft2 = $m_ft*$m_ft
$m3_ft3 = $m2_ft2*$m_ft
$h_min = 60.0
$k_c = 0.5781759824
$rho_c = 0.062428
$cp_c = 0.000239
$w_btu = 3.412
$k_r = 9/5.0
$q_c = $w_btu/$m2_ft2
$u_c = $q_c/$k_r

def c_f(c)
  return c*9/5.0 + 32.0
end

# Internal use
nsteps = 10
%>

<%
# ETNA Case Variables
if cell == "A"

  cell_A_east_wall = "EastWall"
  cell_A_west_wall = "WestWall"
  cell_A_east_wall_azimuth = 90
  cell_A_west_wall_azimuth = 270
  window_latitude_name = "East"
  window_latitude_azimuth = 90
  temperature = "Teast"

  if insulated_windows

    # ET110A1 and ET110A2
    import_file = "ET110A-measured-data.csv"
    interior_absorptivity_window_glass = 0.500
    interior_absorptivity_window_frame = 0.343
    exterior_absorptivity_window_glass = 0.419
    exterior_absorptivity_window_frame = 0.419
    interior_coefficient_window_glass = 7.0
    interior_coefficient_window_inner_frame = 7.0
    $convection_model = "INPUT"

    if imputed_conductivities

      # ET110A1
      infiltration = 0
      material_conductivity_styrodur_north_wall_door = 0.0563 * $k_c
      material_conductivity_polystyrene_east_wall = 0.0407 * $k_c
      material_conductivity_polystyrene_south_wall = 0.0383 * $k_c
      material_conductivity_polystyrene_west_wall = 0.0597 * $k_c
      material_conductivity_glass_wool_ceiling  = 0.0364 * $k_c
      material_conductivity_polystyrene_floor = 0.0719 * $k_c
      material_conductivity_insulated_block_floor = 0.0719 * $k_c
      material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.1643 * $k_c
      material_conductivity_air_gap_windows = 0.1234 * $k_c
      material_conductivity_glass_wool_1_windows = 0.0657 * $k_c
      material_conductivity_polystyrene_1_windows = 0.0657 * $k_c
      material_conductivity_glass_wool_2_windows = 0.0657 * $k_c
      material_conductivity_glass_wool_3_windows = 2.6227 * $k_c
      material_conductivity_polystyrene_2_windows = 2.6227 * $k_c
      material_conductivity_blended_pvc_facing_plasterboard = 3.3570 * $k_c

    else

      # ET110A2
      infiltration = 0.05775
      material_conductivity_styrodur_north_wall_door = 0.032 * $k_c
      material_conductivity_polystyrene_east_wall = 0.043 * $k_c
      material_conductivity_polystyrene_south_wall = 0.043 * $k_c
      material_conductivity_polystyrene_west_wall = 0.043 * $k_c
      material_conductivity_glass_wool_ceiling  = 0.042 * $k_c
      material_conductivity_polystyrene_floor = 0.040 * $k_c
      material_conductivity_insulated_block_floor = 0.040 * $k_c
      material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.093 * $k_c
      material_conductivity_air_gap_windows = 0.062 * $k_c
      material_conductivity_glass_wool_1_windows = 0.033 * $k_c
      material_conductivity_polystyrene_1_windows = 0.033 * $k_c
      material_conductivity_glass_wool_2_windows = 0.033 * $k_c
      material_conductivity_glass_wool_3_windows = 0.208 * $k_c
      material_conductivity_polystyrene_2_windows = 0.208 * $k_c
      material_conductivity_blended_pvc_facing_plasterboard = 0.267 * $k_c

    end

  else

    # ET100A1 and ET100A3
    import_file = "ET100A-measured-data.csv"
    interior_absorptivity_window_glass = 0.129
    interior_absorptivity_window_frame = 0.343
    exterior_absorptivity_window_glass = 0.129
    exterior_absorptivity_window_frame = 0.343
    infiltration = 0
    material_conductivity_styrodur_north_wall_door = 0.0563 * $k_c
    material_conductivity_polystyrene_east_wall = 0.0407 * $k_c
    material_conductivity_polystyrene_south_wall = 0.0383 * $k_c
    material_conductivity_polystyrene_west_wall = 0.0597 * $k_c
    material_conductivity_glass_wool_ceiling  = 0.0364 * $k_c
    material_conductivity_polystyrene_floor = 0.0719 * $k_c
    material_conductivity_insulated_block_floor = 0.0719 * $k_c
    material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.1643 * $k_c
    material_conductivity_air_gap_windows = 0.1234 * $k_c
    material_conductivity_glass_wool_1_windows = 0.0657 * $k_c
    material_conductivity_polystyrene_1_windows = 0.0657 * $k_c
    material_conductivity_glass_wool_2_windows = 0.0657 * $k_c
    material_conductivity_glass_wool_3_windows = 2.6227 * $k_c
    material_conductivity_polystyrene_2_windows = 2.6227 * $k_c
    material_conductivity_blended_pvc_facing_plasterboard = 0.267 * $k_c

    if constant_interior_coefficients

      # ET100A1
      interior_coefficient_window_glass = 12
      interior_coefficient_window_inner_frame = 12
      $convection_model = "INPUT"

    else

      # ET100A3
      $convection_model = "UNIFIED"

    end

  end

elsif cell == "B"

    cell_A_east_wall = "WestWall"
    cell_A_west_wall = "EastWall"
    cell_A_east_wall_azimuth = 270
    cell_A_west_wall_azimuth = 90
    window_latitude_name = "West"
    window_latitude_azimuth = 270
    temperature = "Twest"

  if insulated_windows

    # ET110B1 and ET110B2
    import_file = "ET110B-measured-data.csv"
    interior_absorptivity_window_glass = 0.500
    interior_absorptivity_window_frame = 0.343
    exterior_absorptivity_window_glass = 0.419
    exterior_absorptivity_window_frame = 0.419
    interior_coefficient_window_glass = 7.0
    interior_coefficient_window_inner_frame = 7.0
    $convection_model = "INPUT"

    if imputed_conductivities

      # ET110B1
      infiltration = 0
      material_conductivity_styrodur_north_wall_door = 0.0518 * $k_c
      material_conductivity_polystyrene_east_wall = 0.0353 * $k_c
      material_conductivity_polystyrene_south_wall = 0.0503 * $k_c
      material_conductivity_polystyrene_west_wall = 0.0505 * $k_c
      material_conductivity_glass_wool_ceiling  = 0.0340 * $k_c
      material_conductivity_polystyrene_floor = 0.0853 * $k_c
      material_conductivity_insulated_block_floor = 0.0853 * $k_c
      material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.1514 * $k_c
      material_conductivity_air_gap_windows = 0.1292 * $k_c
      material_conductivity_glass_wool_1_windows = 0.0688 * $k_c
      material_conductivity_polystyrene_1_windows = 0.0688 * $k_c
      material_conductivity_glass_wool_2_windows = 0.0688 * $k_c
      material_conductivity_glass_wool_3_windows = 2.7444 * $k_c
      material_conductivity_polystyrene_2_windows = 2.7444 * $k_c
      material_conductivity_blended_pvc_facing_plasterboard = 3.5128 * $k_c

    else

      # ET110B2
      infiltration = 0.02045
      material_conductivity_styrodur_north_wall_door = 0.032 * $k_c
      material_conductivity_polystyrene_east_wall = 0.043 * $k_c
      material_conductivity_polystyrene_south_wall = 0.043 * $k_c
      material_conductivity_polystyrene_west_wall = 0.043 * $k_c
      material_conductivity_glass_wool_ceiling  = 0.042 * $k_c
      material_conductivity_polystyrene_floor = 0.040 * $k_c
      material_conductivity_insulated_block_floor = 0.040 * $k_c
      material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.093 * $k_c
      material_conductivity_air_gap_windows = 0.062 * $k_c
      material_conductivity_glass_wool_1_windows = 0.033 * $k_c
      material_conductivity_polystyrene_1_windows = 0.033 * $k_c
      material_conductivity_glass_wool_2_windows = 0.033 * $k_c
      material_conductivity_glass_wool_3_windows = 0.208 * $k_c
      material_conductivity_polystyrene_2_windows = 0.208 * $k_c
      material_conductivity_blended_pvc_facing_plasterboard = 0.267 * $k_c

    end

  else

    # ET100B1 and ET100B3
    import_file = "ET100B-measured-data.csv"
    interior_absorptivity_window_glass = 0.129
    interior_absorptivity_window_frame = 0.343
    exterior_absorptivity_window_glass = 0.129
    exterior_absorptivity_window_frame = 0.343
    infiltration = 0
    material_conductivity_styrodur_north_wall_door = 0.0518 * $k_c
    material_conductivity_polystyrene_east_wall = 0.0353 * $k_c
    material_conductivity_polystyrene_south_wall = 0.0503 * $k_c
    material_conductivity_polystyrene_west_wall = 0.0505 * $k_c
    material_conductivity_glass_wool_ceiling  = 0.0340 * $k_c
    material_conductivity_polystyrene_floor = 0.0853 * $k_c
    material_conductivity_insulated_block_floor = 0.0853 * $k_c
    material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door = 0.1514 * $k_c
    material_conductivity_air_gap_windows = 0.1292 * $k_c
    material_conductivity_glass_wool_1_windows = 0.0688 * $k_c
    material_conductivity_polystyrene_1_windows = 0.0688 * $k_c
    material_conductivity_glass_wool_2_windows = 0.0688 * $k_c
    material_conductivity_glass_wool_3_windows = 2.7444 * $k_c
    material_conductivity_polystyrene_2_windows = 2.7444 * $k_c
    material_conductivity_blended_pvc_facing_plasterboard = 0.267 * $k_c

    if constant_interior_coefficients

      # ET100B1
      interior_coefficient_window_glass = 12
      interior_coefficient_window_inner_frame = 12
      $convection_model = "INPUT"

    else

      # ET100B3
      $convection_model = "UNIFIED"

    end

  end

end 
%>

<%
# Dimensions
width = 3.500*$m_ft
depth = 4.655*$m_ft
height = 2.565*$m_ft
floor_area = width*depth
zone_vol = floor_area*height
%>

wfName = "weather/etna/ET110meteoGMT+1_within_Melun-071530_MY.2000_v3.epw"
nSubSteps = <%= nsteps %>
DT = No
bldgAzm = <%= orientation %>
terrainClass = 3
wuDays = 0
skyModel = ANISOTROPIC
skyModelLW = BERDAHLMARTIN
hConvMod = No

METER "MtrElec"

IMPORTFILE CaseData
  imFileName = "<%= "output/etna/INPUTS/" + import_file %>"
  imFreq = Hour

// Materials

MATERIAL "Wallpaper"
  matCond = <%= 0.14*$k_c %>
  matDens = <%= 700*$rho_c %>
  matSpHt = <%= 1340*$cp_c %>

MATERIAL "Plasterboard"
  matCond = <%= 0.35*$k_c %>
  matDens = <%= 850*$rho_c %>
  matSpHt = <%= 800*$cp_c %>

MATERIAL "Air/Honeycomb Cardboard"
  matCond = <%= 0.307*$k_c %>
  matDens = <%= 26.1*$rho_c %>
  matSpHt = <%= 1340*$cp_c %>

MATERIAL "Styrodur North Wall"
  matCond = <%= material_conductivity_styrodur_north_wall_door %>
  matDens = <%= 18*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Polystyrene East Wall"
  matCond = <%= material_conductivity_polystyrene_east_wall %>
  matDens = <%= 15*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Air Gap Walls"
  matCond = <%= 0.070*$k_c %>
  matDens = <%= 1.2*$rho_c %>
  matSpHt = <%= 1000*$cp_c %>

MATERIAL "Hollow Block"
  matCond = <%= 1.052*$k_c %>
  matDens = <%= 1200*$rho_c %>
  matSpHt = <%= 950*$cp_c %>

MATERIAL "Facing"
  matCond = <%= 1.15*$k_c %>
  matDens = <%= 1950*$rho_c %>
  matSpHt = <%= 850*$cp_c %>

MATERIAL "Polystyrene South Wall" LIKE "Polystyrene East Wall"
  matCond = <%= material_conductivity_polystyrene_south_wall %>

MATERIAL "Polystyrene West Wall" LIKE "Polystyrene East Wall"
  matCond = <%= material_conductivity_polystyrene_west_wall %>

MATERIAL "Glass Wool 1 Ceiling"
  matCond = <%= material_conductivity_glass_wool_ceiling %>
  matDens = <%= 11*$rho_c %>
  matSpHt = <%= 800*$cp_c %>

MATERIAL "Glass Wool 2 Ceiling" COPY "Glass Wool 1 Ceiling"

MATERIAL "Air Gap Ceiling" LIKE "Air Gap Walls"
  matCond = <%= 0.618*$k_c %>

MATERIAL "Particle Board"
  matCond = <%= 0.17*$k_c %>
  matDens = <%= 700*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Planks"
  matCond = <%= 0.15*$k_c %>
  matDens = <%= 500*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Ceramic Tile"
  matCond = <%= 1.75*$k_c %>
  matDens = <%= 2177*$rho_c %>
  matSpHt = <%= 920*$cp_c %>

MATERIAL "Glue Cement"
  matCond = <%= 1.50*$k_c %>
  matDens = <%= 1900*$rho_c %>
  matSpHt = <%= 840*$cp_c %>

MATERIAL "Concrete"
  matCond = <%= 1.75*$k_c %>
  matDens = <%= 2177*$rho_c %>
  matSpHt = <%= 920*$cp_c %>

MATERIAL "Concrete + Tubes + Polystyrene Ribs"
  matCond = <%= 1.47*$k_c %>
  matDens = <%= 1813*$rho_c %>
  matSpHt = <%= 954*$cp_c %>

MATERIAL "Polystyrene 1 Floor"
  matCond = <%= material_conductivity_polystyrene_floor %>
  matDens = <%= 16*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Polystyrene 2 Floor" COPY "Polystyrene 1 Floor"

MATERIAL "Plastic Lining"
  matCond = <%= 0.124*$k_c %>
  matDens = <%= 265*$rho_c %>
  matSpHt = <%= 1170*$cp_c %>

MATERIAL "Concrete Slab"
  matCond = <%= 1.75*$k_c %>
  matDens = <%= 2200*$rho_c %>
  matSpHt = <%= 950*$cp_c %>

MATERIAL "Insulated Block 1"
  matCond = <%= material_conductivity_insulated_block_floor %>
  matDens = <%= 18*$rho_c %>
  matSpHt = <%= 1200*$cp_c %>

MATERIAL "Insulated Block 2" COPY "Insulated Block 1"

MATERIAL "Concrete Beam 2"
  matCond = <%= 1.75*$k_c %>
  matDens = <%= 2200*$rho_c %>
  matSpHt = <%= 950*$cp_c %>

MATERIAL "Concrete Beam 1" COPY "Concrete Beam 2"

MATERIAL "Blended Wood/Air/Cardboard + Plywood + Plexiglass"
  matCond = <%= material_conductivity_blended_wood_air_cardboard_plywood_plexiglass_door %>
  matDens = <%= 307*$rho_c %>
  matSpHt = <%= 1317*$cp_c %>

MATERIAL "Blended Air Gap"
  matCond = <%= 0.254*$k_c %>
  matDens = <%= 1.2*$rho_c %>
  matSpHt = <%= 1000*$cp_c %>

MATERIAL "Styrodur Door" COPY "Styrodur North Wall"

MATERIAL "Blended Glass/Air Gap/Glass"
  matCond = <%= 0.124*$k_c %>
  matDens = <%= 1081*$rho_c %>
  matSpHt = <%= 900*$cp_c %>

MATERIAL "Air Gap Windows" LIKE "Air Gap Walls"
  matCond = <%= material_conductivity_air_gap_windows %>

MATERIAL "Glass Wool 1 Windows" LIKE "Glass Wool 1 Ceiling"
  matCond = <%= material_conductivity_glass_wool_1_windows %>

MATERIAL "Polystyrene 1 Windows" LIKE "Polystyrene 1 Floor"
  matCond = <%= material_conductivity_polystyrene_1_windows %>

MATERIAL "PVC"
  matCond = <%= 0.16*$k_c %>
  matDens = <%= 1380*$rho_c %>
  matSpHt = <%= 1000*$cp_c %>

MATERIAL "Glass Wool 2 Windows" LIKE "Glass Wool 2 Ceiling"
  matCond = <%= material_conductivity_glass_wool_2_windows %>

MATERIAL "Blended PVC + Facing + Plasterboard"
  matCond = <%= material_conductivity_blended_pvc_facing_plasterboard %>
  matDens = <%= 1442*$rho_c %>
  matSpHt = <%= 975*$cp_c %>

MATERIAL "Glass Wool 3"
  matCond = <%= material_conductivity_glass_wool_3_windows %>
  matDens = <%= 316*$rho_c %>
  matSpHt = <%= 808*$cp_c %>

MATERIAL "Polystyrene 2 Windows"
  matCond = <%= material_conductivity_polystyrene_2_windows %>
  matDens = <%= 320*$rho_c %>
  matSpHt = <%= 1145*$cp_c %>

// Constructions

CONSTRUCTION "NorthWall"
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>
  LAYER lrMat="Air/Honeycomb Cardboard" lrThk=<%= 0.046*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Styrodur North Wall" lrThk=<%= 0.060*$m_ft %>

<% if cell == "A" %>
CONSTRUCTION "EastWall"
<% else %>
CONSTRUCTION "WestWall"
<% end %>
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Polystyrene East Wall" lrThk=<%= 0.080*$m_ft %>
  LAYER lrMat="Air Gap Walls" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Hollow Block" lrThk=<%= 0.200*$m_ft %>
  LAYER lrMat="Facing" lrThk=<%= 0.020*$m_ft %>

CONSTRUCTION "SouthWall"
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Polystyrene South Wall" lrThk=<%= 0.080*$m_ft %>
  LAYER lrMat="Air Gap Walls" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Hollow Block" lrThk=<%= 0.200*$m_ft %>
  LAYER lrMat="Facing" lrThk=<%= 0.020*$m_ft %>

<% if cell == "B" %>
CONSTRUCTION "EastWall"
<% else %>
CONSTRUCTION "WestWall"
<% end %>
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Polystyrene West Wall" lrThk=<%= 0.080*$m_ft %>
  LAYER lrMat="Air Gap Walls" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Hollow Block" lrThk=<%= 0.200*$m_ft %>
  LAYER lrMat="Air Gap Walls" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Polystyrene West Wall" lrThk=<%= 0.080*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.010*$m_ft %>
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>

CONSTRUCTION "CeilingPath1"
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>
  LAYER lrMat="Glass Wool 1 Ceiling" lrThk=<%= 0.200*$m_ft %>
  LAYER lrMat="Air Gap Ceiling" lrThk=<%= 0.100*$m_ft %>
  LAYER lrMat="Particle Board" lrThk=<%= 0.021*$m_ft %>

CONSTRUCTION "CeilingPath2"
  LAYER lrMat="Wallpaper" lrThk=<%= 0.001*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>
  LAYER lrMat="Glass Wool 2 Ceiling" lrThk=<%= 0.150*$m_ft %>
  LAYER lrMat="Planks" lrThk=<%= 0.150*$m_ft %>
  LAYER lrMat="Particle Board" lrThk=<%= 0.021*$m_ft %>

CONSTRUCTION "FloorPath1"
  LAYER lrMat="Ceramic Tile" lrThk=<%= 0.006*$m_ft %>
  LAYER lrMat="Glue Cement" lrThk=<%= 0.003*$m_ft %>
  LAYER lrMat="Concrete" lrThk=<%= 0.008*$m_ft %>
  LAYER lrMat="Concrete + Tubes + Polystyrene Ribs" lrThk=<%= 0.016*$m_ft %>
  LAYER lrMat="Polystyrene 1 Floor" lrThk=<%= 0.035*$m_ft %>
  LAYER lrMat="Plastic Lining" lrThk=<%= 0.002*$m_ft %>
  LAYER lrMat="Concrete Slab" lrThk=<%= 0.065*$m_ft %>
  LAYER lrMat="Insulated Block 1" lrThk=<%= 0.070*$m_ft %>
  LAYER lrMat="Insulated Block 2" lrThk=<%= 0.050*$m_ft %>
  LAYER lrMat="Polystyrene 2 Floor" lrThk=<%= 0.030*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>

CONSTRUCTION "FloorPath2"
  LAYER lrMat="Ceramic Tile" lrThk=<%= 0.006*$m_ft %>
  LAYER lrMat="Glue Cement" lrThk=<%= 0.003*$m_ft %>
  LAYER lrMat="Concrete" lrThk=<%= 0.008*$m_ft %>
  LAYER lrMat="Concrete + Tubes + Polystyrene Ribs" lrThk=<%= 0.016*$m_ft %>
  LAYER lrMat="Polystyrene 1 Floor" lrThk=<%= 0.035*$m_ft %>
  LAYER lrMat="Plastic Lining" lrThk=<%= 0.002*$m_ft %>
  LAYER lrMat="Concrete Slab" lrThk=<%= 0.065*$m_ft %>
  LAYER lrMat="Insulated Block 1" lrThk=<%= 0.070*$m_ft %>
  LAYER lrMat="Concrete Beam 2" lrThk=<%= 0.050*$m_ft %>
  LAYER lrMat="Polystyrene 2 Floor" lrThk=<%= 0.030*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>

CONSTRUCTION "FloorPath3"
  LAYER lrMat="Ceramic Tile" lrThk=<%= 0.006*$m_ft %>
  LAYER lrMat="Glue Cement" lrThk=<%= 0.003*$m_ft %>
  LAYER lrMat="Concrete" lrThk=<%= 0.008*$m_ft %>
  LAYER lrMat="Concrete + Tubes + Polystyrene Ribs" lrThk=<%= 0.016*$m_ft %>
  LAYER lrMat="Polystyrene 1 Floor" lrThk=<%= 0.035*$m_ft %>
  LAYER lrMat="Plastic Lining" lrThk=<%= 0.002*$m_ft %>
  LAYER lrMat="Concrete Slab" lrThk=<%= 0.065*$m_ft %>
  LAYER lrMat="Concrete Beam 1" lrThk=<%= 0.070*$m_ft %>
  LAYER lrMat="Concrete Beam 2" lrThk=<%= 0.050*$m_ft %>
  LAYER lrMat="Polystyrene 2 Floor" lrThk=<%= 0.030*$m_ft %>
  LAYER lrMat="Plasterboard" lrThk=<%= 0.013*$m_ft %>

CONSTRUCTION "NorthWallPath2"
  LAYER lrMat="Blended Wood/Air/Cardboard + Plywood + Plexiglass" lrThk=<%= 0.036*$m_ft %>
  LAYER lrMat="Blended Air Gap" lrThk=<%= 0.038*$m_ft %>
  LAYER lrMat="Styrodur Door" lrThk=<%= 0.060*$m_ft %>

CONSTRUCTION "WindowsPath1"
  LAYER lrMat="Blended Glass/Air Gap/Glass" lrThk=<%= 0.020*$m_ft %>
<% if insulated_windows %>  
  LAYER lrMat="Air Gap Windows" lrThk=<%= 0.009*$m_ft %>
  LAYER lrMat="Glass Wool 1 Windows" lrThk=<%= 0.200*$m_ft %>
  LAYER lrMat="Polystyrene 1 Windows" lrThk=<%= 0.070*$m_ft %>
<% end %>

CONSTRUCTION "WindowsPath2"
  LAYER lrMat="PVC" lrThk=<%= 0.062*$m_ft %>
<% if insulated_windows %>
  LAYER lrMat="Glass Wool 2 Windows" lrThk=<%= 0.188*$m_ft %>
  LAYER lrMat="Polystyrene 1 Windows" lrThk=<%= 0.070*$m_ft %>
<% end %>

CONSTRUCTION "WindowsPath3"
  LAYER lrMat="Blended PVC + Facing + Plasterboard" lrThk=<%= 0.062*$m_ft %>
<% if insulated_windows %>
  LAYER lrMat="Glass Wool 3" lrThk=<%= 0.188*$m_ft %>
  LAYER lrMat="Polystyrene 2 Windows" lrThk=<%= 0.070*$m_ft %>
<% end %>

ZONE "Cell"
  znModel = "CZM"
  znArea = <%= floor_area %>
  znVol = <%= zone_vol %>
  znFloorZ = 0
  znCeilingHt = <%= height %>
  infAC = <%= infiltration %>
  znTH = import(CaseData,"TCell") * 9/5 + 32
  znQMxH = <%= 10000000*$w_btu %>
  znCAir = <%= 0.24*0.077*zone_vol %>

<%
# Surfaces
surfaces = [
  {:name=>"CeilingPath1",   :type=>"Ceiling", :area=>14.4025,                                 :windows=>0,        :doors=>0,      :temp=>"Tattic",  :interior_coefficient=>3.6,                                     :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.300},
  {:name=>"CeilingPath2",   :type=>"Ceiling", :area=>1.8900,                                  :windows=>0,        :doors=>0,      :temp=>"Tattic",  :interior_coefficient=>3.6,                                     :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.300},
  {:name=>"FloorPath1",     :type=>"Floor",   :area=>13.3525,                                 :windows=>0,        :doors=>0,      :temp=>"Tcellar", :interior_coefficient=>5.3,                                     :interior_absorptivity=>0.249,                              :exterior_absorptivity=>0.300},
  {:name=>"FloorPath2",     :type=>"Floor",   :area=>1.4700,                                  :windows=>0,        :doors=>0,      :temp=>"Tcellar", :interior_coefficient=>5.3,                                     :interior_absorptivity=>0.249,                              :exterior_absorptivity=>0.300},
  {:name=>"FloorPath3",     :type=>"Floor",   :area=>1.4700,                                  :windows=>0,        :doors=>0,      :temp=>"Tcellar", :interior_coefficient=>5.3,                                     :interior_absorptivity=>0.249,                              :exterior_absorptivity=>0.300},
  {:name=>"NorthWall",      :type=>"Wall",    :area=>7.1494,  :azm=>0,                        :windows=>0,        :doors=>"door", :temp=>"Tnorth",  :interior_coefficient=>10.5,                                    :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.300},
  {:name=>"NorthWallPath2", :type=>"Wall",    :area=>1.8281,  :azm=>0,                        :windows=>0,        :doors=>0,      :temp=>"Tnorth",  :interior_coefficient=>10.5,                                    :interior_absorptivity=>0.439,                              :exterior_absorptivity=>0.439},
  {:name=>cell_A_east_wall, :type=>"Wall",    :area=>10.1378, :azm=>cell_A_east_wall_azimuth, :windows=>"window", :doors=>0,      :temp=>"Teast",   :interior_coefficient=>7.0,                                     :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.419},
  {:name=>"SouthWall",      :type=>"Wall",    :area=>7.1752,  :azm=>180,                      :windows=>"window", :doors=>0,      :temp=>"Tsouth",  :interior_coefficient=>7.0,                                     :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.419},
  {:name=>cell_A_west_wall, :type=>"Wall",    :area=>11.9401, :azm=>cell_A_west_wall_azimuth, :windows=>0,        :doors=>0,      :temp=>"Twest",   :interior_coefficient=>5.3,                                     :interior_absorptivity=>0.343,                              :exterior_absorptivity=>0.343},
  {:name=>"WindowsPath1",   :type=>"Window",  :area=>0.9905,                                  :windows=>0,        :doors=>0,      :temp=>"Window",  :interior_coefficient=>interior_coefficient_window_glass,       :interior_absorptivity=>interior_absorptivity_window_glass, :exterior_absorptivity=>exterior_absorptivity_window_glass},
  {:name=>"WindowsPath2",   :type=>"Window",  :area=>0.1385,                                  :windows=>0,        :doors=>0,      :temp=>"Window",  :interior_coefficient=>interior_coefficient_window_inner_frame, :interior_absorptivity=>interior_absorptivity_window_frame, :exterior_absorptivity=>exterior_absorptivity_window_frame},
  {:name=>"WindowsPath3",   :type=>"Window",  :area=>0.6734,                                  :windows=>0,        :doors=>0,      :temp=>"Window",  :interior_coefficient=>12.0,                                    :interior_absorptivity=>interior_absorptivity_window_frame, :exterior_absorptivity=>exterior_absorptivity_window_frame}
]

# Surface Constants
$exterior_coefficient = 18
$long_wave_emissivity = 0

# Azimuths for windows on east/west and south walls
window_azimuths = [
  {:name=>window_latitude_name,:azm=>window_latitude_azimuth,:temp=>temperature},
  {:name=>"South",:azm=>180,:temp=>"Tsouth"}
]
%>

<% def create_surface_data_members(surface,constant_interior_coefficients) %>
sfExHcModel = INPUT
    sfInHcModel = <%= $convection_model %>
    sfExHcMult = <%= $exterior_coefficient * $w_btu / $m2_ft2 / $k_r %>
<% if constant_interior_coefficients %>
    sfInHcMult = <%= surface[:interior_coefficient] * $w_btu / $m2_ft2 / $k_r %>
<% end %>
    sfExAbs = <%= surface[:exterior_absorptivity] %>
    sfInAbs = <%= surface[:interior_absorptivity] %>
    sfExEpsLW = 0
    sfInEpsLW = 0
    sfArea = <%= surface[:area] * $m2_ft2 %> 
    sfCon = <%= surface[:name] %>
    sfExCnd = SPECIFIEDT
    sfModel = FORWARD_DIFFERENCE
    sfGrndRefl = 0.2
<% end %>

<% for surface in surfaces %>
  <% if surface[:type] == "Window" %>
    <% for window_azimuth in window_azimuths %>
  SURFACE "<%= surface[:name] + window_azimuth[:name] %>"
    sfType = Wall
    sfAzm = <%= window_azimuth[:azm] %>
    sfExT = import(CaseData, <%= window_azimuth[:temp] %>) * 9/5 + 32
    <% create_surface_data_members(surface,constant_interior_coefficients) %>
    <% end %>
  <% else %>
  SURFACE "<%= surface[:name] %>"
  <% end %>
  <% if surface[:type] == "Wall" %>
    sfType = Wall
    sfAzm = <%= surface[:azm] %>
    sfExT = import(CaseData, <%= surface[:temp] %>) * 9/5 + 32
    <% create_surface_data_members(surface,constant_interior_coefficients) %>
  <% elsif surface[:type] == "Ceiling" %>
    sfType = Ceiling
    sfExT = import(CaseData, <%= surface[:temp] %>) * 9/5 + 32
    <% create_surface_data_members(surface,constant_interior_coefficients) %>
  <% elsif surface[:type] == "Floor" %>
    sfType = Floor
    sfExT = import(CaseData, <%= surface[:temp] %>) * 9/5 + 32
    <% create_surface_data_members(surface,constant_interior_coefficients) %>
  <% elsif surface[:type] == "Door" %>
    sfType = Wall
    sfAzm = <%= surface[:azm] %>
    sfExT = import(CaseData, <%= surface[:temp] %>) * 9/5 + 32
    <% create_surface_data_members(surface,constant_interior_coefficients) %>
  <% end %>
<% end %>

GAIN "Fan"
  gnZone = "Cell"
  gnEndUse = FANH
  gnPower = import(CaseData,"Qfan") * <%= $w_btu %>
  gnMeter = "MtrElec"

EXPORTFILE "Output"
  xfFileName = "Output.csv"
  xfFileStat = OVERWRITE

EXPORT
  exExportfile = "Output"
  exHeader = ColumnsOnly
  exFooter = No
  exType = UDT
  exFreq = HOUR
  exDayBeg = JAN 1
  exDayEnd = DEC 31

<%
# Input Checks
input_temperature_surface_checks = [
  {:name=>"CeilingPath1"},
  {:name=>"FloorPath1"},
  {:name=>"NorthWall"},
  {:name=>"EastWall"},
  {:name=>"SouthWall"},
  {:name=>"WestWall"}
]

# Outputs
if cell == "A"

  output_surface_fluxes = [
    {:name=>"CeilingPath1"},
    {:name=>"CeilingPath2"},
    {:name=>"FloorPath1"},
    {:name=>"FloorPath2"},
    {:name=>"FloorPath3"},
    {:name=>"NorthWall"},
    {:name=>"NorthWallPath2"},
    {:name=>"EastWall"},
    {:name=>"WindowsPath1East"},
    {:name=>"WindowsPath2East"},
    {:name=>"WindowsPath3East"},
    {:name=>"SouthWall"},
    {:name=>"WindowsPath1South"},
    {:name=>"WindowsPath2South"},
    {:name=>"WindowsPath3South"},
    {:name=>"WestWall"}
  ]

elsif cell == "B"

  output_surface_fluxes = [
    {:name=>"CeilingPath1"},
    {:name=>"CeilingPath2"},
    {:name=>"FloorPath1"},
    {:name=>"FloorPath2"},
    {:name=>"FloorPath3"},
    {:name=>"NorthWall"},
    {:name=>"NorthWallPath2"},
    {:name=>"EastWall"},
    {:name=>"SouthWall"},
    {:name=>"WindowsPath1South"},
    {:name=>"WindowsPath2South"},
    {:name=>"WindowsPath3South"},
    {:name=>"WestWall"},
    {:name=>"WindowsPath1West"},
    {:name=>"WindowsPath2West"},
    {:name=>"WindowsPath3West"},
  ]

end
%>

// Export Results

  EXPORTCOL colHead="Month" colVal=$month
  EXPORTCOL colHead="Day" colVal=$dayOfMonth
  EXPORTCOL colHead="Hour" colVal=$hour
<% for surface in input_temperature_surface_checks %>
  EXPORTCOL colHead="<%= surface[:name] %> Surface Temperature - Simulation [C]" colVal=(@surface["<%= surface[:name] %>"].sfExT - 32) / 1.8
<% end %>
  EXPORTCOL colHead="Cell Temperature - Simulation [C]" colVal=(@znRes["Cell"].H.tAir - 32) / 1.8
  EXPORTCOL colHead="Fan-Simulation [Wh]" colVal=@gain["Fan"].gnPower / <%= $w_btu %>
  EXPORTCOL colHead="Heater-Simulation [Wh]" colVal=@znRes["Cell"].H.qhMech / <%= $w_btu %>
<% for surface in output_surface_fluxes %>
  EXPORTCOL colHead="<%= surface[:name] %> Heat Flux [Wh/m2]" colVal=(@xsurf["<%= surface[:name] %>"].sbcI.qSrf * <%= $m2_ft2 / $w_btu %>)
<% end %>

RUN
