name: Test

on: push

jobs:
  test-std140:
    name: Test std140
    runs-on: windows-2022
    defaults:
      run:
        shell: pwsh
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Download & Install modelkit  # Install modelkit
        run: |
          curl https://download.bigladdersoftware.com/cache/59ee305838d1e7c9241c207eebc8116b9552cf0f/modelkit-catalyst-0.5.0.exe --output ./modelkit-installer.exe
          .\modelkit-installer.exe /SP- /VERYSILENT /DIR="${{ github.workspace }}\modelkit-folder"
      - name: Add modelkit to path
        run: |
          "${{ github.workspace }}\modelkit-folder\bin" >> $env:GITHUB_PATH
      - name: Check directories
        run: |
          echo $env:path
          dir
          dir cases
          dir "${{ github.workspace }}\modelkit-folder"
          dir "${{ github.workspace }}\modelkit-folder\bin"
      - name: Test modelkit bat
        run: .\modelkit-folder\bin\modelkit.bat
      - name: Test modelkit command
        run: modelkit --version
      - name: Create template for single case
        run: |
          mkdir tempCase
          dir "${{ github.workspace }}\base-section-5.pxt"
          modelkit template-compose '${{ github.workspace }}\base-section-5.pxt'
          dir "${{ github.workspace }}\tempCase"
      - name: Run rake test
        run: |
          modelkit rake